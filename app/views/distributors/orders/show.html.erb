<div class="row mb-4">
  <div class="col-12">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h1 class="mb-2">
          <i class="bi bi-receipt text-primary"></i> Order Details
        </h1>
        <p class="text-muted">Order #<%= @order.order_number %></p>
      </div>
      <div>
        <%= link_to distributors_order_path(@order, format: :pdf), 
            class: "btn btn-outline-danger",
            target: "_blank" do %>
          <i class="bi bi-file-pdf me-2"></i>Download PDF
        <% end %>
      </div>
    </div>
  </div>
</div>

<!-- Status Badge (if you add status to orders) -->
<% if @order.respond_to?(:status) %>
<div class="row mb-3">
  <div class="col-12">
    <div class="alert alert-info d-flex align-items-center">
      <i class="bi bi-info-circle me-2"></i>
      Order Status: <%= status_badge(@order.status) %>
    </div>
  </div>
</div>
<% end %>

<!-- Order Information Cards -->
<div class="row mb-4">
  <!-- Order Details -->
  <div class="col-md-6 mb-3">
    <div class="card h-100 shadow-sm">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">
          <i class="bi bi-info-circle me-2"></i>Order Information
        </h5>
      </div>
      <div class="card-body">
        <table class="table table-borderless mb-0">
          <tbody>
            <tr>
              <td class="text-muted">
                <i class="bi bi-hash me-2"></i>Order Number:
              </td>
              <td class="text-end">
                <strong class="text-primary"><%= @order.order_number %></strong>
              </td>
            </tr>
            <tr>
              <td class="text-muted">
                <i class="bi bi-calendar-event me-2"></i>Order Date:
              </td>
              <td class="text-end">
                <%= @order.created_at.strftime('%B %d, %Y at %I:%M %p') %>
              </td>
            </tr>
            <tr>
              <td class="text-muted">
                <i class="bi bi-truck me-2"></i>Required Delivery:
              </td>
              <td class="text-end">
                <span class="badge bg-warning text-dark">
                  <%= @order.required_delivery_date.strftime('%B %d, %Y') %>
                </span>
              </td>
            </tr>
            <tr>
              <td class="text-muted">
                <i class="bi bi-building me-2"></i>Distributor:
              </td>
              <td class="text-end">
                <strong><%= @order.distributor.name %></strong>
              </td>
            </tr>
            <tr>
              <td class="text-muted">
                <i class="bi bi-person me-2"></i>Ordered By:
              </td>
              <td class="text-end">
                <small class="text-muted"><%= @order.user.email %></small>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  
  <!-- Order Summary -->
  <div class="col-md-6 mb-3">
    <div class="card h-100 shadow-sm border-success">
      <div class="card-header bg-success text-white">
        <h5 class="mb-0">
          <i class="bi bi-calculator me-2"></i>Order Summary
        </h5>
      </div>
      <div class="card-body">
        <div class="text-center mb-3">
          <div class="text-muted small mb-2">GRAND TOTAL</div>
          <div class="display-4 text-success fw-bold">
            <%= @order.order_items.first&.sku&.currency || "ZAR" %> 
            <%= number_with_precision(@order.total_amount, precision: 2, delimiter: ',') %>
          </div>
        </div>
        
        <hr>
        
        <div class="d-flex justify-content-between mb-2">
          <span class="text-muted">
            <i class="bi bi-box me-1"></i>Total Items:
          </span>
          <strong><%= pluralize(@order_items.count, 'item') %></strong>
        </div>
        
        <div class="d-flex justify-content-between mb-2">
          <span class="text-muted">
            <i class="bi bi-stack me-1"></i>Total Pallets:
          </span>
          <strong><%= @order_items.sum(:quantity) %> pallets</strong>
        </div>
        
        <div class="d-flex justify-content-between">
          <span class="text-muted">
            <i class="bi bi-grid-3x3 me-1"></i>Total Units:
          </span>
<strong><%= number_with_delimiter(@order_items.sum(:quantity) * OrderItem::UNITS_PER_PALLET) %> units</strong>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Order Items Table -->
<div class="card shadow-sm">
  <div class="card-header bg-white border-bottom">
    <h5 class="mb-0">
      <i class="bi bi-list-ul me-2 text-primary"></i>Order Items
    </h5>
  </div>
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th width="25%">
              <i class="bi bi-box-seam me-1"></i>Product
            </th>
            <th width="20%">
              <i class="bi bi-tag me-1"></i>SKU Name
            </th>
            <th width="15%">
              <i class="bi bi-upc me-1"></i>SKU Code
            </th>
            <th width="12%" class="text-end">
              <i class="bi bi-currency-dollar me-1"></i>Unit Price
            </th>
            <th width="10%" class="text-center">
              <i class="bi bi-box me-1"></i>Pallets
            </th>
            <th width="10%" class="text-center">
              <i class="bi bi-grid-3x3 me-1"></i>Units
            </th>
            <th width="13%" class="text-end">
              <i class="bi bi-calculator me-1"></i>Total
            </th>
          </tr>
        </thead>
        <tbody>
          <% @order_items.each do |item| %>
            <tr>
              <td>
                <div class="d-flex align-items-center">
                  <div class="bg-primary bg-opacity-10 rounded p-2 me-2">
                    <i class="bi bi-box text-primary"></i>
                  </div>
                  <strong><%= item.sku.product.name %></strong>
                </div>
              </td>
              <td><%= item.sku.name %></td>
              <td>
                <code class="bg-light px-2 py-1 rounded">
                  <%= item.sku.sku_code %>
                </code>
              </td>
              <td class="text-end">
                <%= item.sku.currency %> 
                <%= number_with_precision(item.unit_price, precision: 2, delimiter: ',') %>
              </td>
              <td class="text-center">
                <span class="badge bg-primary"><%= item.quantity %></span>
              </td>
              <td class="text-center">
                <small class="text-muted">
                  <%= number_with_delimiter((item.quantity * OrderItem::UNITS_PER_PALLET)) %>
                </small>
              </td>
              <td class="text-end">
                <strong class="text-success">
                  <%= item.sku.currency %> 
                  <%= number_with_precision(item.total_price, precision: 2, delimiter: ',') %>
                </strong>
              </td>
            </tr>
          <% end %>
        </tbody>
        <tfoot class="table-success">
          <tr>
            <th colspan="6" class="text-end align-middle py-3">
              <h5 class="mb-0">Grand Total:</h5>
            </th>
            <th class="text-end py-3">
              <h4 class="mb-0 text-success">
                <%= @order.order_items.first&.sku&.currency %> 
                <%= number_with_precision(@order.total_amount, precision: 2, delimiter: ',') %>
              </h4>
            </th>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
</div>

<!-- Action Buttons -->
<div class="d-flex justify-content-between mt-4 mb-5">
  <%= link_to distributors_orders_path, class: "btn btn-outline-secondary btn-lg" do %>
    <i class="bi bi-arrow-left me-2"></i>Back to Orders
  <% end %>
  
  <div>
    <%= link_to distributors_order_path(@order, format: :pdf), 
        class: "btn btn-outline-danger btn-lg me-2",
        target: "_blank" do %>
      <i class="bi bi-file-pdf me-2"></i>Download PDF
    <% end %>
    
    <%= link_to new_distributors_order_path, class: "btn btn-success btn-lg" do %>
      <i class="bi bi-cart-plus me-2"></i>Place Another Order
    <% end %>
  </div>
</div>

<!-- Help Section -->
<div class="row mt-4">
  <div class="col-12">
    <div class="card border-info">
      <div class="card-body">
        <h6 class="mb-3">
          <i class="bi bi-info-circle text-info me-2"></i>Order Information
        </h6>
        <div class="row">
          <div class="col-md-4">
            <small class="text-muted">
              <strong>Pallet Size:</strong> Each pallet contains 4,800 units
            </small>
          </div>
          <div class="col-md-4">
            <small class="text-muted">
              <strong>Delivery:</strong> Please confirm delivery arrangements 48 hours in advance
            </small>
          </div>
          <div class="col-md-4">
            <small class="text-muted">
              <strong>Support:</strong> Contact your Union Swiss representative for any queries
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>