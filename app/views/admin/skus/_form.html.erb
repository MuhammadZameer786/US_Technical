<h1 class="mb-4">
  <%= @sku.new_record? ? 'Add SKU to' : 'Edit SKU for' %> 
  <%= @product.name %>
</h1>

<%= form_with model: @sku, url: @sku.new_record? ? admin_product_skus_path(@product) : admin_product_sku_path(@product, @sku), local: true do |f| %>
  <% if @sku.errors.any? %>
    <div class="alert alert-danger">
      <h4><%= pluralize(@sku.errors.count, "error") %> prohibited this SKU from being saved:</h4>
      <ul>
        <% @sku.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="card">
    <div class="card-body">
      <div class="mb-3">
        <%= f.label :name, "SKU Name", class: "form-label" %>
        <%= f.text_field :name, class: "form-control", id: "sku_name", placeholder: "e.g., 60ml Bottle", required: true %>
        <small class="form-text text-muted">Enter the size or variant (e.g., "125ml Bottle", "200ml Bottle")</small>
      </div>

      <div class="mb-3">
        <%= f.label :sku_code, "SKU Code", class: "form-label" %>
        <%= f.text_field :sku_code, class: "form-control", id: "sku_code", placeholder: "e.g., BIO-OIL-60ML", required: true %>
        <small class="form-text text-muted">Unique code for this SKU (letters, numbers, and hyphens only)</small>
      </div>

            <div class="mb-3">
        <%= f.label :name, "SKU Currency", class: "form-label" %>
        <%= f.text_field :currency, class: "form-control", id: "sku_name", placeholder: "e.g., 60ml Bottle", required: true %>
        <small class="form-text text-muted">Enter the size or variant (e.g., "125ml Bottle", "200ml Bottle")</small>
      </div>

            <div class="mb-3">
        <%= f.label :name, "SKU Price", class: "form-label" %>
        <%= f.text_field :price, class: "form-control", id: "sku_name", placeholder: "e.g., 60ml Bottle", required: true %>
        <small class="form-text text-muted">Enter the size or variant (e.g., "125ml Bottle", "200ml Bottle")</small>
      </div>

      <div class="d-flex justify-content-between">
        <%= link_to "Cancel", admin_product_path(@product), class: "btn btn-secondary" %>
        <%= f.submit @sku.new_record? ? "Create SKU" : "Update SKU", class: "btn btn-primary" %>
      </div>
    </div>
  </div>
<% end %>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const nameField = document.getElementById('sku_name');
    const codeField = document.getElementById('sku_code');
    
    // Get product name from Rails and convert to uppercase prefix
    const productName = "<%= @product.name.gsub("'", "\\\\'") %>";
    const productPrefix = productName
      .split(' ')
      .map(word => word.toUpperCase())
      .join('-');
    
    // Auto-fill SKU code when name field changes
    nameField.addEventListener('input', function() {
      // Only auto-fill if code field is empty or still has the auto-generated format
      const currentCode = codeField.value;
      const shouldAutoFill = !currentCode || currentCode.startsWith(productPrefix);
      
      if (shouldAutoFill && this.value.trim()) {
        // Convert SKU name to code format
        const skuSuffix = this.value
          .trim()
          .toUpperCase()
          .replace(/[^A-Z0-9]+/g, '-')  // Replace non-alphanumeric with hyphens
          .replace(/^-+|-+$/g, '');      // Remove leading/trailing hyphens
        
        // Combine product prefix with SKU suffix
        codeField.value = productPrefix + '-' + skuSuffix;
      }
    });
    
    // Optional: Pre-fill with just product name if creating new SKU
    <% if @sku.new_record? %>
      if (!codeField.value) {
        codeField.placeholder = productPrefix + '-...';
      }
    <% end %>
  });
</script>