<h1 class="mb-4">
  <%= @distributor_sku.new_record? ? 'Assign SKU to' : 'Edit Pricing for' %> 
  <%= @distributor.name %>
</h1>

<%= form_with model: @distributor_sku, url: @distributor_sku.new_record? ? admin_distributor_distributor_skus_path(@distributor) : admin_distributor_distributor_sku_path(@distributor, @distributor_sku), local: true do |f| %>
  <% if @distributor_sku.errors.any? %>
    <div class="alert alert-danger">
      <h4><%= pluralize(@distributor_sku.errors.count, "error") %> prohibited this from being saved:</h4>
      <ul>
        <% @distributor_sku.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="card">
    <div class="card-body">
      <div class="mb-3">
        <%= f.label :sku_id, "Select SKU", class: "form-label" %>
        <%= f.select :sku_id, 
            grouped_options_for_select(@available_skus.group_by { |s| s.product.name }.map { |product, skus| [product, skus.map { |s| ["#{s.name} (#{s.sku_code})", s.id] }] }, @distributor_sku.sku_id),
            { include_blank: "Choose a SKU" },
            { class: "form-select", required: true, disabled: !@distributor_sku.new_record? } %>
      </div>

      <div class="mb-3">
        <%= f.label :price, class: "form-label" %>
        <div class="input-group">
          <span class="input-group-text">R</span>
          <%= f.number_field :price, class: "form-control", step: "0.01", min: "0.01", placeholder: "0.00", required: true %>
        </div>
      </div>

      <div class="d-flex justify-content-between">
        <%= link_to "Cancel", admin_distributor_path(@distributor), class: "btn btn-secondary" %>
        <%= f.submit @distributor_sku.new_record? ? "Assign SKU" : "Update Pricing", class: "btn btn-primary" %>
      </div>
    </div>
  </div>
<% end %>
